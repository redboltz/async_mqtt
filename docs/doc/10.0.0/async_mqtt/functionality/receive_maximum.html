<!DOCTYPE html>
<html lang="en">
  <head>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Receive Maximum :: async_mqtt</title>
  <link rel="canonical" href="https://antora.cppalliance.org/develop/lib/doc/async_mqtt/functionality/receive_maximum.html">
    <link rel="prev" href="request_response.html">
    <link rel="next" href="maximum_packet_size.html">
  <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../_/css/boostlook.css">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/vendor/tabs.css">
    <script>var uiRootPath = '../../_'</script>
<link rel="icon" href="../../_/img/favicons/favicon.ico" type="image/x-icon">
    <!-- Favicon configuration -->
    <link rel="apple-touch-icon" sizes="180x180" href="../../_/img/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../_/img/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../_/img/favicons/favicon-16x16.png">
    <link rel="manifest" href="../../_/img/favicons/site.webmanifest">
    <link rel="shortcut icon" href="../../_/img/favicons/favicon.ico">
  </head>
  <body class="article toc2 toc-left">
    <div class="boostlook">
  <div id="header">
    <div id="toc" class="nav-container toc2" data-component="async_mqtt" data-version="">
  <aside class="nav">
    <button class="nav-close"></button>
    <div class="panels">
      <div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
      <h3 class="title"><a href="../index.html">async_mqtt</a></h3>
      <ul class="nav-list">
        <ul class="nav-list">
        <li class="" data-depth="1">
            <a class="nav-link" href="../reference.html">Reference</a>
        </li>
              <li class="" data-depth="1">
            <a class="nav-link" href="../CHANGELOG.html">History</a>
        </li>
              <li class="" data-depth="1">
            <span class="nav-text">Introduction</span>
        </li>
        <ul class="nav-list">
        <li class="" data-depth="2">
            <a class="nav-link" href="../requirements.html">Requirements</a>
        </li>
              <li class="" data-depth="2">
            <a class="nav-link" href="../goal.html">Design Goal</a>
        </li>
        </ul>
        <li class="" data-depth="1">
            <span class="nav-text">Quick Look</span>
        </li>
        <ul class="nav-list">
        <li class="" data-depth="2">
            <a class="nav-link" href="../quicklook.html">Simple Pub/Sub client</a>
        </li>
              <li class="" data-depth="2">
            <a class="nav-link" href="../performance.html">Performance</a>
        </li>
              <li class="" data-depth="2">
            <a class="nav-link" href="../comparison.html">Comparison</a>
        </li>
        </ul>
        <li class="" data-depth="1">
            <span class="nav-text">Tutorial</span>
        </li>
        <ul class="nav-list">
        <li class="" data-depth="2">
            <a class="nav-link" href="../header.html">Header Files</a>
        </li>
              <li class="" data-depth="2">
            <a class="nav-link" href="../tutorial/client.html">Client</a>
        </li>
              <li class="" data-depth="2">
            <span class="nav-text">Endpoint</span>
        </li>
        <ul class="nav-list">
        <li class="" data-depth="3">
            <a class="nav-link" href="../tutorial/create_endpoint.html">Create endpoint</a>
        </li>
              <li class="" data-depth="3">
            <a class="nav-link" href="../tutorial/cpp20_coro.html">C++20 coroutine</a>
        </li>
              <li class="" data-depth="3">
            <a class="nav-link" href="../tutorial/sl_coro.html">Stackless coroutine</a>
        </li>
              <li class="" data-depth="3">
            <a class="nav-link" href="../tutorial/send_recv.html">Send/Recv packets</a>
        </li>
        </ul>
  </ul>
        <li class="" data-depth="1">
            <span class="nav-text">Functionality</span>
        </li>
        <ul class="nav-list">
        <li class="" data-depth="2">
            <a class="nav-link" href="packet_based.html">Packet-Based APIs</a>
        </li>
              <li class="" data-depth="2">
            <a class="nav-link" href="non_packet_based.html">Non packet based APIs</a>
        </li>
              <li class="" data-depth="2">
            <a class="nav-link" href="packet_id.html">Packet Identifier Management</a>
        </li>
              <li class="" data-depth="2">
            <a class="nav-link" href="connect_timeout.html">Connect Timeout</a>
        </li>
              <li class="" data-depth="2">
            <a class="nav-link" href="keep_session.html">Keep session</a>
        </li>
              <li class="" data-depth="2">
            <a class="nav-link" href="resend.html">Resend message</a>
        </li>
              <li class="" data-depth="2">
            <a class="nav-link" href="topic_alias.html">Topic Alias</a>
        </li>
              <li class="" data-depth="2">
            <a class="nav-link" href="request_response.html">Request/Response</a>
        </li>
              <li class=" is-current-page" data-depth="2">
            <a class="nav-link" href="receive_maximum.html">Receive Maximum</a>
        </li>
              <li class="" data-depth="2">
            <a class="nav-link" href="maximum_packet_size.html">Maximum Packet Size</a>
        </li>
              <li class="" data-depth="2">
            <a class="nav-link" href="thread_safe.html">Thread Safety</a>
        </li>
              <li class="" data-depth="2">
            <a class="nav-link" href="logging.html">Logging</a>
        </li>
              <li class="" data-depth="2">
            <a class="nav-link" href="error_report.html">Error Reporting</a>
        </li>
        </ul>
        <li class="" data-depth="1">
            <a class="nav-link" href="../sansio.html">I/O Independent MQTT Protocol Machine</a>
        </li>
              <li class="" data-depth="1">
            <span class="nav-text">Customize/Config</span>
        </li>
        <ul class="nav-list">
        <li class="" data-depth="2">
            <a class="nav-link" href="../customize.html">Customize Underlying Layer</a>
        </li>
              <li class="" data-depth="2">
            <a class="nav-link" href="../config.html">Config</a>
        </li>
              <li class="" data-depth="2">
            <a class="nav-link" href="../separate.html">Separate Compilation Mode</a>
        </li>
        </ul>
        <li class="" data-depth="1">
            <span class="nav-text">Tools</span>
        </li>
        <ul class="nav-list">
        <li class="" data-depth="2">
            <a class="nav-link" href="../tool/container.html">Run async_mqtt broker/client on the docker container</a>
        </li>
              <li class="" data-depth="2">
            <a class="nav-link" href="../tool/trial.html">Free trial broker on cloud</a>
        </li>
              <li class="" data-depth="2">
            <a class="nav-link" href="../tool/broker.html">broker</a>
        </li>
              <li class="" data-depth="2">
            <a class="nav-link" href="../tool/client_cli.html">client_cli</a>
        </li>
              <li class="" data-depth="2">
            <a class="nav-link" href="../tool/bench.html">bench</a>
        </li>
        </ul>
        <li class="" data-depth="1">
            <a class="nav-link" href="http://github.com/redboltz/async_mqtt">Repository</a>
        </li>
        </ul>
  </ul>
  </nav>
</div>
    </div>
  </aside>
</div>
</div>
  <div id="content">
    <article class="doc max-width-reset">
  <div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li>
      <a href="../index.html" aria-label="Home: async_mqtt">
        <svg xmlns="http://www.w3.org/2000/svg" width="1rem" height="1rem" viewBox="0 -960 960 960" fill="#000000" aria-hidden="true"><path d="M160-120v-480l320-240 320 240v480H560v-280H400v280H160Z"/></svg>
      </a>
    </li>
    <li>Functionality</li>
    <li><a href="receive_maximum.html">Receive Maximum</a></li>
  </ul>
</nav>
<div class="spirit-nav">
    <a accesskey="p" href="request_response.html"><span class="material-symbols-outlined" title="Previous: Request/Response">arrow_back</span></a>
    <a accesskey="p" href="maximum_packet_size.html"><span class="material-symbols-outlined" title="Next: Maximum Packet Size">arrow_forward</span></a>
</div>
</div>
    <h1 class="page">Receive Maximum</h1>
  <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Receive Maximum is a way to flow control PUBLISH (QoS1, QoS2) packets. They require storage for resending. So the node should prepare the memory packet size * Receive Maximum. The maximum value of the packet size can be defined using <a href="maximum_packet_size.html" class="xref page">Maximum Packet Size</a>. If the node sends over the Receive Maximum packets, then it is protocol error. The counterpart disconnects the connection with DISCONNECT packet with Reason Code 0x93 (Receive Maximum exceeded).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_when_to_increasedecrease_the_receive_count"><a class="anchor" href="#_when_to_increasedecrease_the_receive_count"></a>When to Increase/Decrease the Receive Count?</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>When the node sends/receives a PUBLISH (QoS1 or QoS2) packet, the receive count is increased.</p>
</li>
<li>
<p>When the node sends/receives a PUBACK packet corresponding to the PUBLISH QoS1 packet, the receive count is decreased.</p>
</li>
<li>
<p>When the node sends/receives a PUBCOMP packet corresponding to the PUBLISH QoS2 packet, the receive count is decreased.</p>
</li>
<li>
<p>When the node sends/receives a PUBREC packet corresponding to the PUBLISH QoS2 packet, and if the PUBREC Reason Code is an error, then the receive count is decreased.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The timing for decreasing the receive count is the same as when the Packet Identifier becomes reusable.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Packet Identifier and Receive Maximum are not directly related. Packet Identifier is not only used for PUBLISH (QoS1 or QoS2) packets but also for SUBSCRIBE/UNSUBSCRIBE packets.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_notifying_receive_maximum"><a class="anchor" href="#_notifying_receive_maximum"></a>Notifying Receive Maximum</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are two independent Receive Maximum limits.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/receive_maximum.svg" alt="receive_maximum">
</div>
</div>
<div class="sect2">
<h3 id="_broker_to_client_receive_maximum"><a class="anchor" href="#_broker_to_client_receive_maximum"></a>broker to client Receive Maximum</h3>
<div class="paragraph">
<p>The client can set the <code>Receive Maximum</code> property, with a value greater than 0, to the CONNECT packet. This means the client can concurrently receive PUBLISH (QoS1 or QoS2) packets until the receive count reaches the Receive Maximum.</p>
</div>
</div>
<div class="sect2">
<h3 id="_client_to_client_receive_maximum"><a class="anchor" href="#_client_to_client_receive_maximum"></a>client to client Receive Maximum</h3>
<div class="paragraph">
<p>The broker can set the <code>Receive Maximum</code> property, with a value greater than 0, to the CONNACK packet. This means the broker can concurrently receive PUBLISH (QoS1 or QoS2) packets until the receive count reaches the Receive Maximum.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_async_mqtt_implementation"><a class="anchor" href="#_async_mqtt_implementation"></a>async_mqtt implementation</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>async_mqtt</code> automatically respects the Receive Maximum, so users don&#8217;t need to worry about it. If a user calls <code>async_send()</code> with PUBLISH (QoS1 or QoS2) packets more than the received Receive Maximum times before the publish sequence finishes, async_mqtt internally queues the PUBLISH packets. When the receive count decreases, the queued PUBLISH packets are sent. The order of sending the PUBLISH packets is the same as the order of the user&#8217;s <code>async_send()</code> function calls.</p>
</div>
<div class="paragraph">
<p>There is no explicit limitation on the number of queued packets. However, in order to create PUBLISH (QoS1 or QoS2) packets, the user needs to acquire a Packet Identifier. This is limited to a maximum of 65535, so it also limits the number of queued packets.</p>
</div>
</div>
</div>
  <div class="edit-this-page">
      <a href="file:///home/kondo/work/async_mqtt/doc/modules/ROOT/pages/functionality/receive_maximum.adoc">Edit this Page</a>
  </div>
      <nav class="pagination">
        <span class="prev"><a href="request_response.html">Request/Response</a></span>
        <span class="next"><a href="maximum_packet_size.html">Maximum Packet Size</a></span>
    </nav>
</article>
</div>
  <div id="footer">
  <script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script async src="../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab"></script>
</div>
</div>
  </body>
</html>
